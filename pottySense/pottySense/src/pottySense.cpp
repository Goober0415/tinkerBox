/*
 * Project pottySense
 * Author: Jamie Dowden-Duarte
 * Date: 11/11/2025
 * For comprehensive documentation and examples, please visit:
 * https://docs.particle.io/firmware/best-practices/firmware-template/
 */

// Include Particle Device OS APIs
#include "Particle.h"
#include "IoTClassroom_CNM.h"
#include "neopixel.h"
#include "Adafruit_SSD1306.h"
#include "Adafruit_GFX.h"

//////////////////
// Global varibles
//////////////////

//////////////////
// Constants
//////////////////
const int LAS = D3;
const int PIXELCOUNT = 37;
const int ADDY = 0X3C;
const int OLED_RESET = -1;
const int BPIN = D4;
const int PHOTO = D16;
const int PEELEVEL = D17;
const int PIXELMAP[5][5] = {{0, 1, 2, 3, 4},
                            {5, 6, 7, 8, 9},
                            {10, 11, 12, 13, 14},
                            {15, 16, 17, 18, 19},
                            {20, 21, 22, 23, 24}};

const unsigned char duckie[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x07, 0xFC, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x0C, 0x07, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x30, 0x01, 0x80, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x60, 0x00, 0xC0, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x40, 0x00, 0x60, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x00, 0x20, 0x00, 0x00, 0x00,
    0x00, 0x01, 0x80, 0x00, 0x30, 0x00, 0x00, 0x00,
    0x00, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
    0x00, 0x01, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
    0x00, 0x01, 0x06, 0x00, 0x10, 0x00, 0x00, 0x00,
    0x00, 0x01, 0x0F, 0x00, 0x10, 0x00, 0x00, 0x00,
    0x00, 0x03, 0xC7, 0x00, 0x10, 0x00, 0x00, 0x00,
    0x00, 0x06, 0x60, 0x00, 0x10, 0x00, 0x00, 0x00,
    0x00, 0x0C, 0x30, 0x00, 0x30, 0x00, 0x00, 0x00,
    0x00, 0x08, 0x10, 0x00, 0x20, 0x00, 0x00, 0x00,
    0x00, 0x06, 0x60, 0x00, 0x61, 0xC0, 0x00, 0x00,
    0x00, 0x03, 0xE0, 0x00, 0xC3, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x30, 0x01, 0xDE, 0x30, 0x00, 0x00,
    0x00, 0x00, 0x60, 0x03, 0xF0, 0x18, 0x00, 0x00,
    0x00, 0x00, 0xC0, 0x00, 0x00, 0x08, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x00, 0x00, 0x0C, 0x00, 0x00,
    0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00,
    0x00, 0x03, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00,
    0x00, 0x02, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00,
    0x00, 0x06, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
    0x00, 0x04, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
    0x00, 0x04, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
    0x00, 0x04, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
    0x00, 0x0C, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
    0x00, 0x04, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00,
    0x00, 0x04, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00,
    0x00, 0x06, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00,
    0x00, 0x02, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00,
    0x00, 0x03, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00,
    0x00, 0x01, 0x80, 0x00, 0x00, 0x30, 0x00, 0x00,
    0x00, 0x00, 0xE0, 0x00, 0x00, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x30, 0x00, 0x03, 0x80, 0x00, 0x00,
    0x00, 0x00, 0x0E, 0x00, 0x1E, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x03, 0xFF, 0xF0, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0};

//////////////////
// Variables
//////////////////
bool onOff = false, bright = false, pee;
int i, j, reading;

//////////////////
// Objects
//////////////////
Adafruit_SSD1306 display(OLED_RESET);
Adafruit_NeoPixel pixel(PIXELCOUNT, SPI1, WS2812B);
Button push(BPIN);

SYSTEM_MODE(SEMI_AUTOMATIC);
SYSTEM_THREAD(ENABLED);

void setup()
{
  //////////////////
  // display
  //////////////////
  display.begin(SSD1306_SWITCHCAPVCC, ADDY);
  display.drawBitmap(0, 0, duckie, 128, 64, WHITE);
  display.display();
  //////////////////
  // pixel
  //////////////////
  pixel.begin();
  pixel.setPixelBrightness();
  //////////////////
  // pinMode
  //////////////////
  pinMode(LAS, OUTPUT);
  pinMode(PEELEVEL, INPUT);
}

void loop()
{
  display.clearDisplay();
  pee = digitalRead(PEELEVEL);
  if (pee == 1)
  {
    display.printf("Baby boy pee'd check the bin");
    display.display();
  }
  if (pee == 0)
  {
    display.drawBitmap(0, 0, duckie, 128, 64, WHITE);
    display.display();
  }
  if (push.isClicked())
  {
    onOff = !onOff;
    if (onOff)
    {
      digitalWrite(LAS, HIGH);
      bright = true;
    }
    if (!onOff)
    {
      digitalWrite(LAS, LOW);
      bright = false;
    }
  }

  while (bright == true)
  {
    pixel.clear();
    display.clearDisplay();
    reading = analogRead(PHOTO);
    if (reading > 3000)
    {
      display.printf("Potty training is fun!");
      display.display();
      for (i = 0; i <= PIXELCOUNT; i + 2)
      {
        pixel.setPixelColor(i, blue);
        pixel.setPixelColor(i + 1, purple);
        pixel.show();
      }
    }
    if (reading <= 3000)
    {
      pixel.clear();
      display.clear();
      display.printf("Great job Wyatt, what a big boy!!!");
      display.display();
      for (i = 0; i <= PIXELCOUNT; i + 2)
      {
        pixel.setPixelColor(i, yellow);
        pixel.show();
      }
    }
  }
}
